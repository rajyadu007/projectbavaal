{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load influencer_tags %} 

{% block title %}{{ influencer.name }} - Profile | bavaal.com{% endblock %}
{% block description %}{{ influencer.profile_summary|default_if_none:influencer.biography|truncatechars:160 }}{% endblock %}

{% block content %}
    <div class="main flex-grow">
        {# Influencer Header and Basic Info #}
        <div class="influencer-header bg-white rounded-2xl p-8 shadow-md mb-8">
            <div class="flex flex-col items-center gap-8 md:flex-row md:items-start md:text-left">
                {# Profile Picture #}
                <div class="relative w-52 h-52 flex-shrink-0">
                    {% if influencer.profile_pic %}
                        <img src="{{ influencer.profile_pic.url }}" alt="Profile picture of {{ influencer.name }}" 
                             class="w-full h-full object-cover rounded-full border-5 border-primary-light">
                    {% else %}
                        <img src="{% static 'images/default_profile.png' %}" alt="Default profile picture" 
                             class="w-full h-full object-cover rounded-full border-5 border-primary-light">
                    {% endif %}
                </div>

                {# Basic Details #}
                <div class="flex-1">
                    <h1 class="text-4xl font-extrabold text-primary mb-2 text-center md:text-left">{{ influencer.name }}</h1>
                    {% if influencer.nickname %}
                        <p class="text-text-light text-xl mb-4 text-center md:text-left">Also known as "{{ influencer.nickname }}"</p>
                    {% endif %}
                    
                    {# Social Media Handles #}
                    <div class="social-links flex flex-wrap gap-4 my-5 justify-center md:justify-start">
                        {% if influencer.instagram_handle %}
                            <a href="https://www.instagram.com/{{ influencer.instagram_handle }}" target="_blank" class="social-link text-3xl text-text-light hover:text-pink-600 transition-colors duration-200" aria-label="Instagram profile">
                                <i class="fab fa-instagram"></i>
                            </a>
                        {% endif %}
                        {% if influencer.tiktok_handle %}
                            <a href="https://www.tiktok.com/@{{ influencer.tiktok_handle }}" target="_blank" class="social-link text-3xl text-text-light hover:text-black transition-colors duration-200" aria-label="TikTok profile">
                                <i class="fab fa-tiktok"></i>
                            </a>
                        {% endif %}
                        {% if influencer.youtube_channel %}
                            <a href="https://www.youtube.com/channel/{{ influencer.youtube_channel }}" target="_blank" class="social-link text-3xl text-text-light hover:text-red-600 transition-colors duration-200" aria-label="YouTube channel">
                                <i class="fab fa-youtube"></i>
                            </a>
                        {% endif %}
                        {% if influencer.twitter_handle %}
                            <a href="https://twitter.com/{{ influencer.twitter_handle }}" target="_blank" class="social-link text-3xl text-text-light hover:text-blue-500 transition-colors duration-200" aria-label="Twitter/X profile">
                                <i class="fab fa-twitter"></i>
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            {# Profile Summary #}
            {% if influencer.profile_summary %}
                <div class="mt-6 p-4 rounded-xl bg-primary-light">
                    <p class="text-text leading-relaxed font-medium text-center md:text-left">{{ influencer.profile_summary }}</p>
                </div>
            {% endif %}
        </div>
        
        {# Key Metrics and Personal Details #}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            {# Metrics #}
            <div class="bg-white rounded-2xl p-6 shadow-md">
                <h2 class="text-2xl font-semibold text-primary mb-4">Key Metrics</h2>
                <div class="grid grid-cols-2 gap-4">
                    {% if influencer.instagram_followers %}
                        <div class="stat-card p-4 bg-light rounded-lg text-center">
                            <p class="text-xl font-bold">{{ influencer.instagram_followers|intcomma }}</p>
                            <p class="text-sm text-text-light">Instagram Followers</p>
                        </div>
                    {% endif %}
                    {% if influencer.estimated_net_worth %}
                        <div class="stat-card p-4 bg-light rounded-lg text-center">
                            <p class="text-xl font-bold">${{ influencer.estimated_net_worth|floatformat:2|intcomma }}</p>
                            <p class="text-sm text-text-light">Estimated Net Worth</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            {# Personal Details #}
            <div class="bg-white rounded-2xl p-6 shadow-md">
                <h2 class="text-2xl font-semibold text-primary mb-4">Personal Details</h2>
                <ul class="space-y-2 text-text-light">
                    {% if influencer.full_name %}
                        <li><strong>Full Name:</strong> {{ influencer.full_name }}</li>
                    {% endif %}
                    {% if influencer.date_of_birth %}
                        <li><strong>Born:</strong> {{ influencer.date_of_birth|date:"F j, Y" }} (Age: {{ influencer.age }})</li>
                    {% endif %}
                    {% if influencer.place_of_birth %}
                        <li><strong>Place of Birth:</strong> {{ influencer.place_of_birth }}</li>
                    {% endif %}
                    {% if influencer.height_cm %}
                        <li><strong>Height:</strong> {{ influencer.height_cm }} cm</li>
                    {% endif %}
                    {% if influencer.hair_color %}
                        <li><strong>Hair Color:</strong> {{ influencer.hair_color }}</li>
                    {% endif %}
                    {% if influencer.eye_color %}
                        <li><strong>Eye Color:</strong> {{ influencer.eye_color }}</li>
                    {% endif %}
                </ul>
            </div>
        </div>

        {# Detailed Biography #}
        {% if influencer.biography %}
            <div class="section bg-white rounded-2xl p-6 shadow-md mb-8">
                <h2 class="text-2xl font-semibold text-primary mb-4">Biography</h2>
                <div class="prose max-w-none text-text leading-relaxed">
                    {{ influencer.biography|safe }}
                </div>
            </div>
        {% endif %}
        
        {# Career and Achievements #}
        <div class="section bg-white rounded-2xl p-6 shadow-md mb-8">
            <h2 class="text-2xl font-semibold text-primary mb-4">Career & Achievements</h2>
            <div class="space-y-4">
                {% if influencer.profession %}
                    <div>
                        <h3 class="text-xl font-semibold text-text">Profession</h3>
                        <p class="text-text-light">{{ influencer.profession }}</p>
                    </div>
                {% endif %}
                {% if influencer.education %}
                    <div>
                        <h3 class="text-xl font-semibold text-text">Education</h3>
                        <p class="text-text-light">{{ influencer.education }}</p>
                    </div>
                {% endif %}
                {% if influencer.achievements %}
                    <div>
                        <h3 class="text-xl font-semibold text-text">Achievements</h3>
                        <p class="text-text-light">{{ influencer.achievements }}</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        {# Additional Sections #}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            {% if influencer.businesses %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-primary mb-4">Entrepreneurial Ventures</h2>
                    <p class="text-text-light">{{ influencer.businesses }}</p>
                </div>
            {% endif %}
            
            {% if influencer.brand_collaborations %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-primary mb-4">Brand Collaborations</h2>
                    <p class="text-text-light">{{ influencer.brand_collaborations }}</p>
                </div>
            {% endif %}
            
            {% if influencer.media_appearances %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-primary mb-4">Media Appearances</h2>
                    <p class="text-text-light">{{ influencer.media_appearances }}</p>
                </div>
            {% endif %}
            
            {% if influencer.hobbies %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-primary mb-4">Hobbies & Interests</h2>
                    <p class="text-text-light">{{ influencer.hobbies }}</p>
                </div>
            {% endif %}

            {% if influencer.assets %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-primary mb-4">Assets</h2>
                    <p class="text-text-light">{{ influencer.assets }}</p>
                </div>
            {% endif %}

            {% if influencer.public_perception %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-primary mb-4">Public Perception</h2>
                    <p class="text-text-light">{{ influencer.public_perception }}</p>
                </div>
            {% endif %}
            
            {% if influencer.controversies %}
                <div class="section bg-white rounded-2xl p-6 shadow-md">
                    <h2 class="text-2xl font-semibold text-red-500 mb-4">Controversies</h2>
                    <p class="text-text-light">{{ influencer.controversies }}</p>
                </div>
            {% endif %}
        </div>
        
        {# Media Gallery (Images, Videos, Tweets) #}
        <div class="section bg-white rounded-2xl p-6 shadow-md mb-8">
            <h2 class="text-2xl font-semibold text-primary mb-4">Media Gallery</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for image in influencer.images.all %}
                    <a href="{{ image.image_url }}" target="_blank" class="block group relative overflow-hidden rounded-lg shadow-md transition-all duration-300 hover:shadow-xl">
                        <img src="{{ image.image_url }}" alt="{{ image.caption|default:'Influencer image' }}" class="w-full h-64 object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-center font-medium">{{ image.caption|default:'View image' }}</p>
                        </div>
                    </a>
                {% endfor %}
                {% for video in influencer.videos.all %}
                    <div class="relative overflow-hidden rounded-lg shadow-md aspect-video">
                        {% if video.source == 'youtube' %}
                            <iframe class="w-full h-full" src="https://www.youtube.com/embed/{{ video.video_url|get_youtube_id }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        {% else %}
                            <a href="{{ video.video_url }}" target="_blank" class="block w-full h-full bg-black flex items-center justify-center text-white text-4xl">
                                <i class="fab fa-play-circle"></i>
                            </a>
                        {% endif %}
                    </div>
                {% endfor %}
                {% for tweet in influencer.tweets.all %}
                    <blockquote class="twitter-tweet"><p lang="en" dir="ltr">{{ tweet.caption|default:'' }}</p>&mdash; {{ influencer.name }} (@{{ influencer.twitter_handle|default:'' }}) <a href="{{ tweet.tweet_url }}"></a></blockquote>
                {% endfor %}
            </div>
            
            {# Twitter Script (if tweets exist) #}
            {% if influencer.tweets.all %}
                <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            {% endif %}
        </div>
    </div>
{% endblock %}