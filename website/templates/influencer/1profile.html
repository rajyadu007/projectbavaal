{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
    <div class="main flex-grow">
        {# Influencer Header Section #}
        <div class="influencer-header bg-white rounded-2xl p-8 shadow-md mb-8 flex flex-col items-center gap-8 md:flex-row md:text-left">
            {# Conditional rendering for profile_image #}
            {% if influencer.profile_image %}
                <img src="{{ influencer.profile_image.url }}" alt="{{ influencer.name }}" class="influencer-image w-52 h-52 object-cover rounded-full border-5 border-primary-light">
            {% else %}
                {# Provide a fallback image if no profile_image is uploaded #}
                <img src="{% static 'images/default_profile.png' %}" alt="Default Profile Image" class="influencer-image w-52 h-52 object-cover rounded-full border-5 border-primary-light">
            {% endif %}
            <div class="influencer-info flex-1">
                <h1 class="influencer-name text-4xl font-bold mb-2 text-primary">{{ influencer.name }}</h1>
                <div class="flex flex-wrap gap-2 mb-2 justify-center md:justify-start">
                    {% for category in influencer.categories.all %}
                        <span class="badge inline-block bg-primary-light text-primary px-3 py-1 rounded-full text-xs font-medium">{{ category.name }}</span>
                    {% endfor %}
                </div>

                <p class="influencer-bio text-text-light my-5 leading-relaxed">{{ influencer.bio }}</p>

                <div class="stats-grid grid grid-cols-2 gap-4 my-6 md:grid-cols-4">
                    <div class="stat-card group bg-light text-text rounded-xl p-4 text-center transition-all duration-300 hover:bg-primary hover:text-white">
                        <div class="stat-value text-2xl font-bold mb-1">{{ influencer.get_formatted_followers }}</div>
                        <div class="stat-label text-text-light text-sm group-hover:text-white group-hover:opacity-90">Followers</div>
                    </div>
                    <div class="stat-card group bg-light text-text rounded-xl p-4 text-center transition-all duration-300 hover:bg-primary hover:text-white">
                        <div class="stat-value text-2xl font-bold mb-1">{{ influencer.get_formatted_likes }}</div>
                        <div class="stat-label text-text-light text-sm group-hover:text-white group-hover:opacity-90">Likes</div>
                    </div>
                    <div class="stat-card group bg-light text-text rounded-xl p-4 text-center transition-all duration-300 hover:bg-primary hover:text-white">
                        <div class="stat-value text-2xl font-bold mb-1">{{ influencer.rating|floatformat:1 }}</div>
                        <div class="stat-label text-text-light text-sm group-hover:text-white group-hover:opacity-90">Rating</div>
                    </div>
                    <div class="stat-card group bg-light text-text rounded-xl p-4 text-center transition-all duration-300 hover:bg-primary hover:text-white">
                        <div class="stat-value text-2xl font-bold mb-1">{{ influencer.collaborations_count }}</div>
                        <div class="stat-label text-text-light text-sm group-hover:text-white group-hover:opacity-90">Collabs</div>
                    </div>
                </div>

                <div class="social-links flex gap-3 my-5 justify-center md:justify-start">
                    {% if influencer.instagram_url %}
                        <a href="{{ influencer.instagram_url }}" target="_blank" class="social-link w-10 h-10 rounded-full bg-light flex items-center justify-center text-primary transition-all duration-300 hover:bg-primary hover:text-white hover:-translate-y-0.5">
                            <i class="fab fa-instagram"></i>
                        </a>
                    {% endif %}
                    {% if influencer.tiktok_url %}
                        <a href="{{ influencer.tiktok_url }}" target="_blank" class="social-link w-10 h-10 rounded-full bg-light flex items-center justify-center text-primary transition-all duration-300 hover:bg-primary hover:text-white hover:-translate-y-0.5">
                            <i class="fab fa-tiktok"></i>
                        </a>
                    {% endif %}
                    {% if influencer.youtube_url %}
                        <a href="{{ influencer.youtube_url }}" target="_blank" class="social-link w-10 h-10 rounded-full bg-light flex items-center justify-center text-primary transition-all duration-300 hover:bg-primary hover:text-white hover:-translate-y-0.5">
                            <i class="fab fa-youtube"></i>
                        </a>
                    {% endif %}
                    {% if influencer.twitter_url %}
                        <a href="{{ influencer.twitter_url }}" target="_blank" class="social-link w-10 h-10 rounded-full bg-light flex items-center justify-center text-primary transition-all duration-300 hover:bg-primary hover:text-white hover:-translate-y-0.5">
                            <i class="fab fa-twitter"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        {# Viral Content Section #}
        <div class="section bg-white rounded-2xl p-6 shadow-md mb-8">
            <div class="section-title flex flex-col items-start gap-2 mb-5 text-primary md:flex-row md:justify-between md:items-center">
                <h2 class="text-2xl font-semibold">Viral Content</h2>
                <a href="#" class="view-all text-primary no-underline text-sm font-medium flex items-center gap-1 hover:text-highlight transition-colors duration-200">
                    View all <i class="fas fa-arrow-right text-xs"></i>
                </a>
            </div>
            <div class="content-grid grid grid-cols-[repeat(auto-fill,minmax(250px,1fr))] gap-5">
                {% for content in influencer.contents.all|slice:":3" %}
                    <div class="content-card rounded-xl overflow-hidden transition-all duration-300 border border-primary-light hover:-translate-y-1 hover:shadow-lg hover:border-primary">
                        {# Conditional rendering for content thumbnail #}
                        {% if content.thumbnail %}
                            <img src="{{ content.thumbnail.url }}" alt="Content thumbnail" class="content-thumbnail w-full h-40 object-cover">
                        {% else %}
                            {# Provide a fallback image if no thumbnail is uploaded #}
                            <img src="{% static 'images/default_content_thumbnail.png' %}" alt="Default Content Thumbnail" class="content-thumbnail w-full h-40 object-cover bg-gray-200">
                        {% endif %}
                        <div class="content-details p-4">
                            <h3 class="content-title font-semibold mb-2 text-base">{{ content.title }}</h3>
                            <div class="content-meta flex justify-between text-text-light text-xs">
                                <span><i class="fas fa-eye mr-1"></i> {{ content.views_count|floatformat:0|intcomma }}</span>
                                <span><i class="fas fa-heart mr-1"></i> {{ content.likes_count|floatformat:0|intcomma }}</span>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <p>No viral content available yet.</p>
                {% endfor %}
            </div>
        </div>

        {# Brand Collaborations Section #}
        <div class="section bg-white rounded-2xl p-6 shadow-md mb-8">
            <div class="section-title flex flex-col items-start gap-2 mb-5 text-primary md:flex-row md:justify-between md:items-center">
                <h2 class="text-2xl font-semibold">Brand Collaborations</h2>
                <a href="#" class="view-all text-primary no-underline text-sm font-medium flex items-center gap-1 hover:text-highlight transition-colors duration-200">
                    View all <i class="fas fa-arrow-right text-xs"></i>
                </a>
            </div>
            <div class="content-grid grid grid-cols-[repeat(auto-fill,minmax(250px,1fr))] gap-5">
                {% for collab in influencer.collaborations.all|slice:":3" %}
                    <div class="content-card rounded-xl overflow-hidden transition-all duration-300 border border-primary-light hover:-translate-y-1 hover:shadow-lg hover:border-primary">
                        {# Conditional rendering for collaboration thumbnail #}
                        {% if collab.thumbnail %}
                            <img src="{{ collab.thumbnail.url }}" alt="Brand collab" class="content-thumbnail w-full h-40 object-cover">
                        {% else %}
                            {# Provide a fallback image if no thumbnail is uploaded #}
                            <img src="{% static 'images/default_collab_thumbnail.png' %}" alt="Default Collaboration Thumbnail" class="content-thumbnail w-full h-40 object-cover bg-gray-200">
                        {% endif %}
                        <div class="content-details p-4">
                            <h3 class="content-title font-semibold mb-2 text-base">{{ collab.campaign_name }}</h3>
                            <div class="content-meta flex justify-between text-text-light text-xs">
                                <span>{{ collab.start_date|date:"F Y" }}</span>
                                <span>{% if collab.is_sponsored %}Sponsored{% else %}Organic{% endif %}</span>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <p>No brand collaborations available yet.</p>
                {% endfor %}
            </div>
        </div>

        {# Community Chat Section (remains static for now) #}
        <div class="community-section bg-white rounded-2xl p-6 shadow-md">
            <h2 class="section-title text-2xl font-semibold mb-5 text-primary">Community Chat</h2>
            <div class="chat-container h-96 overflow-y-auto pr-2">
                {# ... static chat messages ... #}
            </div>
            <div class="chat-input-container flex gap-4">
                {# This avatar should be dynamic, showing the currently logged-in user's avatar #}
                <img src="https://randomuser.me/api/portraits/women/33.jpg" alt="You" class="chat-input-avatar w-12 h-12 rounded-full object-cover">
                <div class="chat-input flex-1 flex">
                    <input type="text" placeholder="Send a message to Maya's community..." class="flex-1 px-5 py-3 bg-light border border-primary-light rounded-full text-base text-text focus:outline-none focus:border-primary">
                    <button class="chat-send w-12 h-12 rounded-full bg-primary text-white border-none flex items-center justify-center cursor-pointer ml-3 transition-all duration-300 hover:bg-highlight hover:-translate-y-0.5">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}